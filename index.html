<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File Sharing Platform</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #f4f4f4;
        }

        h1 {
            margin-top: 20px;
            color: #333;
        }

        form {
            margin: 20px 0;
            padding: 10px;
            background: #fff;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        input[type="file"] {
            margin-right: 10px;
        }

        button {
            padding: 5px 10px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }

        button:hover {
            background-color: #0056b3;
        }

        ul {
            list-style: none;
            padding: 0;
        }

        li {
            margin: 5px 0;
        }

        a {
            text-decoration: none;
            color: #007bff;
        }

        a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <h1>File Sharing Platform</h1>

    <form id="uploadForm">
        <input type="file" id="fileInput" required>
        <button type="submit">Upload</button>
    </form>

    <h2>Uploaded Files</h2>
    <ul id="fileList"></ul>

    <script>
        const uploadForm = document.getElementById('uploadForm');
        const fileInput = document.getElementById('fileInput');
        const fileList = document.getElementById('fileList');

        async function uploadFile(file) {
            const formData = new FormData();
            formData.append('file', file);

            const response = await fetch('/api/upload', {
                method: 'POST',
                body: formData
            });

            if (!response.ok) {
                throw new Error('Failed to upload file');
            }

            return response.json();
        }

        uploadForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            const file = fileInput.files[0];
            if (!file) return;

            try {
                const data = await uploadFile(file);

                const listItem = document.createElement('li');
                const link = document.createElement('a');
                link.href = data.filePath;
                link.textContent = file.name;
                link.download = '';

                listItem.appendChild(link);
                fileList.appendChild(listItem);

                fileInput.value = '';
            } catch (error) {
                console.error(error);
                alert('Failed to upload file');
            }
        });
    </script>

    <script>
        // Simulating serverless API for upload
        async function handleServerlessRequest(req, res) {
            if (req.method === 'POST') {
                const chunks = [];
                req.on('data', chunk => chunks.push(chunk));
                req.on('end', () => {
                    const boundary = req.headers['content-type'].split('boundary=')[1];
                    const buffer = Buffer.concat(chunks);
                    const parts = buffer.toString().split(`--${boundary}`);

                    const contentDisposition = parts[1].split('\r\n')[1];
                    const fileName = contentDisposition.match(/filename="(.+?)"/)[1];
                    const fileData = parts[1].split('\r\n\r\n')[1].split('\r\n--')[0];

                    const uploadDir = './uploads';
                    if (!fs.existsSync(uploadDir)) {
                        fs.mkdirSync(uploadDir);
                    }

                    const filePath = `${uploadDir}/${fileName}`;
                    fs.writeFileSync(filePath, fileData, 'binary');

                    res.statusCode = 200;
                    res.end(JSON.stringify({ filePath: `/uploads/${fileName}` }));
                });
            } else {
                res.statusCode = 405;
                res.end(JSON.stringify({ error: 'Method not allowed' }));
            }
        }
    </script>
</body>
</html>
